<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
</head>
<body>
<h2>PCM streaming (AudioWorklet 48kHz ステレオ)</h2>
<button id="start">再生開始</button>
<p>48kHz / Float32 / ステレオ / 遅延 ~0.2〜0.5秒</p>

<script>
let audioCtx;
let ws;

document.getElementById("start").onclick = async () => {
  audioCtx = new AudioContext({
    sampleRate: 48000,
    latencyHint: "interactive"
  });

  await audioCtx.audioWorklet.addModule("worklet.js");

  const workletNode = new AudioWorkletNode(audioCtx, "pcm-player", {
    outputChannelCount: [2],
    channelCount: 2,
    channelCountMode: "explicit",
    channelInterpretation: "speakers"
  });

  workletNode.connect(audioCtx.destination);

  ws = new WebSocket(location.origin.replace("https", "wss") + "/pcm-ws");
  ws.binaryType = "arraybuffer";

  ws.onmessage = (event) => {
    workletNode.port.postMessage(event.data);
  };
};
</script>
</body>
</html>